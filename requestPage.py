import g


def requestPage(rKey, index):
    url = f"http://www.referenceusa.com/UsBusiness/Result/Page?requestKey={rKey}&pageIndex={index}"

    payload = f"requestKey={rKey}&sort=&direction=Ascending&pageIndex={index}&optionalColumn="
    headers = {
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/112.0',
        'Accept': 'text/html, */*; q=0.01',
        'Accept-Language': 'en-US,en;q=0.5',
        'Accept-Encoding': 'gzip, deflate',
        'Connection': 'keep-alive',
        'Content-Type': 'text/plain',
        'Cookie': '_ga_JMDCP9JFFY=GS1.1.1681436963.1.1.1681437104.0.0.0; _ga=GA1.1.188829893.1681436964; _gid=GA1.2.1654664879.1681436964; SESSION_LANGUAGE=eng; III_EXPT_FILE=aa2105; III_SESSION_ID=6eb73e975c404cfd622878d1b12e2865; IIIV933375096=^#BEGMD5^#4ad82d8845dc5fff47552fe4646dfa3f^#ENDMD5^#0-he^|1774857^|45^|121^|0^|0; ASP.NET_SessionId=m5wt2ja3t1stxhluvpbgfe0v; .ASPXAUTH=7AB017C59180391F67A13EFBF59E078827B95E4E7B4BD961C1560932D06E3080162B0606A6FBFA165E8B31D78D54EDD349370AFAE5348591B207BFC1D0CA2C6D5C00A1316E73546B1D8675ECD25618FD489D3E56F017F91AE0D7EA4855B46EAD3790197AF0B46AAE2594D5A5994112E8878EE81100CFE2603EA7E8369D03D491E57CDB6A86EEC8A4FD2326C9D6DC06FE200761C36DC69B82F4ECE790B54B7A986E15728B873D61B977FB8D720AF703BE796E3221CF151A7A540AC577C349E9B71086C4021B2912F5BF2F64D3846D45E350C4AED14363D6B72511DBEFDEBAFD164B24E61EE9BD5C0CB51EA3EB3724C590E82068E3C66F7C000ACF8151B369AD4D4295A9E194D2FFB1DF16BC2E318971D14DDA351CB7A7E014A6F2233C676BADD82A102E28169283351B745FF1FCF874028E25BCB79DA7F172EDA177DA9595ED34135996CF1BE65EF4DF721C19F93F0E7FBB48FE244F48BD889A08EBD85F37F8845F502FDC98680BC3CC4DD933DB974ED77859B82DD3359B0A9A8A70FA2D065106DC95A83EF7839D3B3CFCA5A3F34544F47DBDA35B27E25278509D433D6C92CF2EEDB2922F2FF7FFB9AA1061C05B1820BA3E9DAAB01B4E284894FA500E9F4C506B16F1C8F7D8FF08FF7A1A8ECADE5C377C0AD98800FF9EF62817B79563417829A9E302DEF66E8BB477A758785AE4B809C85D746182CCE9B15D80A66C301F78959BC5879D15E2029EF41577EE59BAA4CC7D702B00062B982C3CABED8537C64547B731922DFF9CF6B0E11DB17DF76AB95FB9; UserAuthenticated=true; BIGipServerrefusa_http=2673518784.20480.0000; TS0180d824=01065b9f50cb74b3c3b0ec2e6222e5ac6ec5c1a13a6c1918deb5b8792b8344eda8be6eacb61e2c937566374b67f47b0297a697d3a8; ai_user=hrg45hBKPHMrBM9zc0a575^|2023-04-14T01:51:44.936Z; _ga_Q1M017Q8EN=GS1.1.1681437106.1.1.1681438373.0.0.0; ai_session=yKITTXABlh9Cq4dfjb1u8L^|1681437106915^|1681437187403; __utma=45961573.188829893.1681436964.1681437107.1681437107.1; __utmb=45961573.5.10.1681437107; __utmc=45961573; __utmz=45961573.1681437107.1.1.utmcsr=(direct)^|utmccn=(direct)^|utmcmd=(none); ln_or=eyIyOTcyNjYiOiJkIn0^%^3D; __hstc=63604784.62b2c95fa5f0493ab798448309f21b3a.1681437107548.1681437107548.1681437107548.1; hubspotutk=62b2c95fa5f0493ab798448309f21b3a; __hssrc=1; __hssc=63604784.5.1681437107548; TS0180d824_77=08cfd42f6fab28003eed9b080f0501b60e8f047fb445baca30312b2d1323e1d865863a93da62848e4fb43bdcafebe850089d79683d824000bd5ab5706894c5f7efc994b76b1ca848fcb5801387387cf6ba231da21c20b01665e33c6136fe87bc810e09bfa37a8c5b158825b5e04c757b9caa7cd18bcfb87c; isUsBusHistoricalTab=false; .ASPXAUTH=2B3B3F019D78E35721B6AF09ECECCBC14039E5E26CFC21A07C91D21044783DDED726E728D480CF3F6ED54C2A6CD3DCDDFF8CF99323C6B095BA47851D0B6F1B3DF94AEB517C9142DF1BA5DFAA59EAEBF332E3AD33B0EE32A20328A8A7E6CC5707CA280428D9911A44038BE8432B1777D90CAAA7DB77BBA56151181F293B032C5E673ED59249BB61C90CF97F403CAF24AE29C6204642503CBD87FBF29BDA95C0FA02176FABC047A85F2EAFD2D91EE69D229E94A090D71B06A3BAE8F7D406A81AAC4CEDA2E2EB6E1893BC2671BAC83AA7D9B5F138E5359A9242D810A9E8BBD990FD1B6902ED89ABB94AEC61E89764FF515EBD8C3C1E1E3A54C9C2FD5EAC7FA8BCECC2D6681EAC05A8EC23A5DDAA7752A32236D80ADF290EF668AC6360A7DBA02BDD86D64B48B67FAE09951274EA60D099FC8C4A624AE046C2B6035B9A8688C7E20BCD0058676105958A884DA7899CB121BFD1DE892690B281E1CD7122F0A8FEDC80B63940690145E8D500538EB0734E26775E89280C78D83FD8B62C8B20188EE98577C63AFA1E146AF84EC1590DEF4A056B63964690D795BBFC031FB3F013412365265A02E85D72E5D8371C0703A8BB95F36232DDD37F211311D694B488D49B0AA7D71E577F1DBAB8791EDDD79EDBAABB0FD4289971CF8F1247955481162110B605FB0317BFD7DF2FA77453BD750A122DA08B2C846A6A8D0ECEF15F3DEB874EDDDAD2D96AEA94BE71014C633C049E4FCCABB5CC3340C1BA428A89B3FA434D70814B403B1D1F5A7DE982DBBE169C20AFA7D1; ASP.NET_SessionId=bpfle3xgn21rylcbdrmxafai; BIGipServerrefusa_http=2690296000.20480.0000; TS0180d824=01065b9f50c67ba787fe11c4369af0e1ce32c41bc825f886a79fa6d33098286fb505aa82ad3372266fd5a066da1df7c5a22016600e; UserAuthenticated=true'        }

    response = g.requests.request("GET", url, headers=headers, data=payload)

    soup = g.BeautifulSoup(response.text, 'html.parser')
    if index == 0:
        script = soup.find("script", string=lambda text: text and "var totalPages" in text)
        # Extract the JavaScript code
        javascript_code = script.string

        # Extract the value of the "totalPages" variable from the JavaScript code
        total_pages = None
        for line in javascript_code.splitlines():
            if 'var totalPages =' in line:
                total_pages = int(line.split('=')[1].strip().replace(';', ''))
                break
        return total_pages
    if index > 0:
        attr_list = soup.findAll(attrs="action-view-record")
        request_list = []
        for i in attr_list:
            r = i.previous_element.next_element.parent.contents[0].attrs['data-tagged-url'].rfind('recordId=')
            request_list.append(i.previous_element.next_element.parent.contents[0].attrs['data-tagged-url'][r+9:])
        return request_list
